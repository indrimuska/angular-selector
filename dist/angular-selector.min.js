/*! angular-selector - v1.3.3 - https://github.com/indrimuska/angular-selector - (c) 2015 Indri Muska - MIT */
!function(a){var b={up:38,down:40,left:37,right:39,escape:27,enter:13,backspace:8,"delete":46,shift:16,leftCmd:91,rightCmd:93,ctrl:17,alt:18,tab:9},c=function(){function c(a){return a instanceof HTMLElement?a.ownerDocument&&a.ownerDocument.defaultView.opener?a.ownerDocument.defaultView.getComputedStyle(a):window.getComputedStyle(a):{}}function d(a,b,c,d,e){this.restrict="EAC",this.replace=!0,this.transclude=!0,this.scope={name:"@?",value:"=model",disabled:"=?disable",required:"=?require",multiple:"=?multi",placeholder:"@?",valueAttr:"@",labelAttr:"@?",groupAttr:"@?",options:"=?",create:"&?",rtl:"=?",api:"=?",change:"&?",remote:"&?",remoteParam:"@?",removeButton:"=?",softDelete:"=?",viewItemTemplate:"=?",dropdownItemTemplate:"=?",dropdownCreateTemplate:"=?",dropdownGroupTemplate:"=?"},this.templateUrl="selector/selector.html",$filter=a,$timeout=b,$window=c,$http=d,$q=e}return d.prototype.$inject=["$filter","$timeout","$window","$http","$q"],d.prototype.link=function(d,e,f,g,h){h(d,function(d,g){var h=a.element(e[0].querySelector(".selector-input input")),i=a.element(e[0].querySelector(".selector-dropdown")),j=$q.defer(),k={api:{},search:"",selectedValues:[],highlighted:0,valueAttr:null,labelAttr:"label",groupAttr:"group",options:[],remoteParam:"q",removeButton:!0,viewItemTemplate:"selector/item-default.html",dropdownItemTemplate:"selector/item-default.html",dropdownCreateTemplate:"selector/item-create.html",dropdownGroupTemplate:"selector/group-default.html"};a.isDefined(g.value)||(g.value=g.multiple?[]:""),a.forEach(k,function(b,c){a.isDefined(g[c])||(g[c]=b)}),a.forEach(["name","valueAttr","labelAttr"],function(a){f[a]||(f[a]=g[a])}),g.optionValue=function(a){return null==g.valueAttr?a:a[g.valueAttr]},g.optionEquals=function(b,c){return a.equals(g.optionValue(b),a.isDefined(c)?c:g.value)},g.setValue=function(a){g.multiple?g.value=null==g.valueAttr?a||[]:(a||[]).map(function(a){return a[g.valueAttr]}):g.value=null==g.valueAttr?a||{}:(a||{})[g.valueAttr]},g.hasValue=function(){return g.multiple?(g.value||[]).length>0:null==g.valueAttr?!a.equals({},g.value):!!g.value},g.fetch=function(){var b,c=g.search||"";if(!g.disabled){if(!a.isDefined(g.remote))throw"Remote attribute is not defined";if(g.loading=!0,g.options=[],b=g.remote({search:c}),"function"!=typeof b.then){var d={method:"GET",cache:!0,params:{}};a.extend(d,g.remote()),a.extend(d.params,g.remote().params),d.params[g.remoteParam]=c,b=$http(d)}b.then(function(a){g.options=a.data||a,g.filterSelected(),g.loading=!1,j.resolve()},function(a){throw g.loading=!1,j.reject(),"Error while fetching data: "+(a.message||a)})}},a.isDefined(g.remote)||(g.remote=!1,j.resolve()),g.remote&&g.$watch("search",g.fetch),g.optionToObject=function(b,c){var d={},e=a.element(b);a.forEach(b.dataset,function(a,b){b.match(/^\$/)||(d[b]=a)}),b.value&&(d[g.valueAttr||"value"]=b.value),e.text()&&(d[g.labelAttr]=e.text().trim()),a.isDefined(c)&&(d[g.groupAttr]=c),g.options.push(d),!e.attr("selected")||!g.multiple&&g.hasValue()||(g.multiple?(g.value||(g.value=[]),g.value.push(g.optionValue(d))):g.value||(g.value=g.optionValue(d)))},g.fillWithHtml=function(){g.options=[],a.forEach(d,function(b){var c=(b.tagName||"").toLowerCase();"option"==c&&g.optionToObject(b),"optgroup"==c&&a.forEach(b.querySelectorAll("option"),function(a){g.optionToObject(a,(b.attributes.label||{}).value)})}),g.updateSelected()},g.initialize=function(){g.remote||a.isArray(g.options)&&g.options.length||g.fillWithHtml(),g.hasValue()&&(g.multiple?a.isArray(g.value)||(g.value=[g.value]):a.isArray(g.value)&&(g.value=g.value[0]),g.updateSelected(),g.filterSelected(),g.updateValue())},g.$watch("multiple",function(){$timeout(g.setInputWidth),j.promise.then(g.initialize,g.initialize)}),g.dropdownPosition=function(){var a=h.parent()[0],b=c(a),d=parseFloat(b.marginTop||0),e=parseFloat(b.marginLeft||0);i.css({top:a.offsetTop+a.offsetHeight+d+"px",left:a.offsetLeft+e+"px",width:a.offsetWidth+"px"})},g.open=function(){g.isOpen=!0,g.dropdownPosition()},g.close=function(){g.isOpen=!1,g.resetInput()},g.decrementHighlighted=function(){g.highlight(g.highlighted-1),g.scrollToHighlighted()},g.incrementHighlighted=function(){g.highlight(g.highlighted+1),g.scrollToHighlighted()},g.highlight=function(a){g.filteredOptions.length&&(g.highlighted=(g.filteredOptions.length+a)%g.filteredOptions.length)},g.scrollToHighlighted=function(){var a=i[0],b=a.querySelectorAll("li.selector-option")[g.highlighted],d=c(b),e=parseFloat(d.marginTop||0),f=parseFloat(d.marginBottom||0);g.filteredOptions.length&&(b.offsetTop+b.offsetHeight+f>a.scrollTop+a.offsetHeight&&$timeout(function(){a.scrollTop=b.offsetTop+b.offsetHeight+f-a.offsetHeight}),b.offsetTop-e<a.scrollTop&&$timeout(function(){a.scrollTop=b.offsetTop-e}))},g.createOption=function(b){var c={};a.isFunction(g.create)?c=g.create({input:b}):(c[g.labelAttr]=b,c[g.valueAttr||"value"]=b),g.options.push(c),g.set(c)},g.set=function(b){a.isDefined(b)||(b=g.filteredOptions[g.highlighted]),g.multiple?g.selectedValues.indexOf(b)<0&&g.selectedValues.push(b):g.selectedValues=[b],g.multiple||g.close(),g.resetInput()},g.unset=function(b){g.multiple?g.selectedValues.splice(a.isDefined(b)?b:g.selectedValues.length-1,1):g.selectedValues=[],g.resetInput()},g.keydown=function(a){switch(a.keyCode){case b.up:if(!g.isOpen)break;g.decrementHighlighted(),a.preventDefault();break;case b.down:g.isOpen?g.incrementHighlighted():g.open(),a.preventDefault();break;case b.escape:g.highlight(0),g.close();break;case b.enter:g.isOpen&&(g.filteredOptions.length?g.set():f.create&&g.createOption(a.target.value),a.preventDefault());break;case b.backspace:if(!h.val()){var c=(g.selectedValues.slice(-1)[0]||{})[g.labelAttr]||"";g.unset(),g.open(),g.softDelete&&(g.search=c,g.multiple&&a.preventDefault())}break;case b.left:case b.right:case b.shift:case b.ctrl:case b.alt:case b.tab:case b.leftCmd:case b.rightCmd:break;default:!g.multiple&&g.hasValue()?a.preventDefault():(g.open(),g.highlight(0))}},g.inOptions=function(b,c){return g.remote?b.filter(function(b){return a.equals(c,b)}).length>0:b.indexOf(c)>=0},g.filterSelected=function(){g.filteredOptions=$filter("filter")(g.options||[],g.search),g.multiple&&(g.filteredOptions=g.filteredOptions.filter(function(b){var c=a.isArray(g.selectedValues)?g.selectedValues:[g.selectedValues];return!g.inOptions(c,b)})),g.highlighted>=g.filteredOptions.length&&g.highlight(g.filteredOptions.length-1)},g.measureWidth=function(){var b,d=c(h[0]),e=a.element('<span class="selector-shadow"></span>');return e.text(h.val()||(g.hasValue()?"":g.placeholder)||""),a.element(document.body).append(e),a.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(a){e.css(a,d[a])}),b=e[0].offsetWidth,e.remove(),b},g.setInputWidth=function(){var a=g.measureWidth()+1;h.css("width",a+"px")},g.resetInput=function(){h.val(""),g.search="",g.setInputWidth()},g.$watch("[search, options, value]",function(){g.filterSelected(),$timeout(function(){g.setInputWidth(),g.isOpen&&g.dropdownPosition()})},!0),g.updateValue=function(b){a.isDefined(b)||(b=g.selectedValues),g.setValue(g.multiple?b:b[0])},g.$watch("selectedValues",function(b,c){a.equals(b,c)||(g.updateValue(),a.isFunction(g.change)&&g.change(g.multiple?{newValue:b,oldValue:c}:{newValue:b[0],oldValue:c[0]}))},!0),g.$watchCollection("options",function(b,c){a.equals(b,c)||g.updateSelected()}),g.updateSelected=function(){g.multiple?g.selectedValues=(g.value||[]).map(function(a){return $filter("filter")(g.options,function(b){return g.optionEquals(b,a)})[0]}).filter(function(b){return a.isDefined(b)}):g.selectedValues=(g.options||[]).filter(function(a){return g.optionEquals(a)}).slice(0,1)},g.$watch("value",function(b,c){a.equals(b,c)||(g.updateSelected(),g.filterSelected(),g.updateValue())},!0),h=a.element(e[0].querySelector(".selector-input input")).on("focus",function(){$timeout(function(){g.$apply(g.open)})}).on("blur",function(){g.$apply(g.close)}).on("keydown",function(a){g.$apply(function(){g.keydown(a)})}).on("input",function(){g.setInputWidth()}),i.on("mousedown",function(a){a.preventDefault()}),a.element($window).on("resize",function(){g.dropdownPosition()}),a.forEach(["open","close","fetch"],function(a){g.api[a]=g[a]}),g.api.focus=function(){h[0].focus()},g.api.set=function(b){var c=(g.filteredOptions||[]).filter(function(a){return g.optionEquals(a,b)});a.forEach(c,function(a){g.set(a)})},g.api.unset=function(b){var c=b?(g.selectedValues||[]).filter(function(a){return g.optionEquals(a,b)}):g.selectedValues,d=g.selectedValues.map(function(a,b){return g.inOptions(c,a)?b:-1}).filter(function(a){return a>=0});a.forEach(d,function(a,b){g.unset(a-b)})}})},d}();a.module("selector",[]).run(["$templateCache",function(a){a.put("selector/selector.html",'<div class="selector-container" ng-attr-dir="{{rtl ? \'rtl\' : \'ltr\'}}" ng-class="{open: isOpen, empty: !filteredOptions.length && (!create || !search), multiple: multiple, \'has-value\': hasValue(), rtl: rtl, loading: loading, \'remove-button\': removeButton, disabled: disabled}"><select name="{{name}}" ng-hide="true" ng-model="selectedValues" multiple ng-options="option as option[labelAttr] for option in selectedValues" ng-hide="true"></select><label class="selector-input"><ul class="selector-values"><li ng-repeat="(index, option) in selectedValues track by index"><div ng-include="viewItemTemplate"></div><div ng-if="multiple" class="selector-helper" ng-click="!disabled && unset(index)"><span class="selector-icon"></span></div></li></ul><input ng-model="search" placeholder="{{!hasValue() ? placeholder : \'\'}}" ng-disabled="disabled" ng-required="required && !hasValue()"><div ng-if="!multiple || loading" class="selector-helper selector-global-helper" ng-click="!disabled && removeButton && unset()"><span class="selector-icon"></span></div></label><ul class="selector-dropdown" ng-show="filteredOptions.length > 0 || (create && search)"><li class="selector-option active" ng-if="filteredOptions.length == 0" ng-include="dropdownCreateTemplate" ng-mouseover="highlight(index)" ng-click="createOption(search)"></li><li ng-repeat-start="(index, option) in filteredOptions track by index" class="selector-optgroup" ng-include="dropdownGroupTemplate" ng-show="option[groupAttr] && index == 0 || filteredOptions[index-1][groupAttr] != option[groupAttr]"></li><li ng-repeat-end ng-class="{active: highlighted == index, grouped: option[groupAttr]}" class="selector-option" ng-include="dropdownItemTemplate" ng-mouseover="highlight(index)" ng-click="set()"></li></ul></div>'),a.put("selector/item-create.html",'Add <i ng-bind="search"></i>'),a.put("selector/item-default.html",'<span ng-bind="option[labelAttr] || option"></span>'),a.put("selector/group-default.html",'<span ng-bind="option[groupAttr]"></span>')}]).directive("selector",["$filter","$timeout","$window","$http","$q",function(a,b,d,e,f){return new c(a,b,d,e,f)}])}(window.angular);